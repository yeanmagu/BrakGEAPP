(function(b){b.fn.bPopup=function(y,e){function H(){z.contentContainer=b(z.contentContainer||C);
switch(z.content){case"iframe":var d=b('<iframe class="b-iframe" '+z.iframeAttr+"></iframe>");
d.appendTo(z.contentContainer);
q=C.outerHeight(!0);
r=C.outerWidth(!0);
A();
d.attr("src",z.loadUrl);
a(z.loadCallback);
break;
case"image":A();
b("<img />").load(function(){a(z.loadCallback);
K(b(this))
}).attr("src",z.loadUrl).hide().appendTo(z.contentContainer);
break;
default:A(),b('<div class="b-ajax-wrapper"></div>').load(z.loadUrl,z.loadData,function(i,j,o){a(z.loadCallback,j);
K(b(this))
}).hide().appendTo(z.contentContainer)
}}function A(){z.modal&&b('<div class="b-modal '+l+'"></div>').css({backgroundColor:z.modalColor,position:"fixed",top:0,right:0,bottom:0,left:0,opacity:0,zIndex:z.zIndex+s}).appendTo(z.appendTo).fadeTo(z.speed,z.opacity);
E();
C.data("bPopup",z).data("id",l).css({left:"slideIn"==z.transition||"slideBack"==z.transition?"slideBack"==z.transition?L.scrollLeft()+t:-1*(u+r):N(!(!z.follow[0]&&g||J)),position:z.positionStyle||"absolute",top:"slideDown"==z.transition||"slideUp"==z.transition?"slideUp"==z.transition?L.scrollTop()+v:w+-1*q:k(!(!z.follow[1]&&n||J)),"z-index":z.zIndex+s+1}).each(function(){z.appending&&b(this).appendTo(z.appendTo)
});
f(!0)
}function p(){z.modal&&b(".b-modal."+C.data("id")).fadeTo(z.speed,0,function(){b(this).remove()
});
z.scrollBar||b("html").css("overflow","auto");
b(".b-modal."+l).unbind("click");
L.unbind("keydown."+l);
M.unbind("."+l).data("bPopup",0<M.data("bPopup")-1?M.data("bPopup")-1:null);
C.undelegate(".bClose, ."+z.closeClass,"click."+l,p).data("bPopup",null);
clearTimeout(F);
f();
return !1
}function O(d){v=x.innerHeight||M.height();
t=x.innerWidth||M.width();
if(B=G()){clearTimeout(c),c=setTimeout(function(){E();
d=d||z.followSpeed;
C.dequeue().each(function(){J?b(this).css({left:u,top:w}):b(this).animate({left:z.follow[0]?N(!0):"auto",top:z.follow[1]?k(!0):"auto"},d,z.followEasing)
})
},50)
}}function K(i){var d=i.width(),j=i.height(),o={};
z.contentContainer.css({height:j,width:d});
j>=C.height()&&(o.height=C.height());
d>=C.width()&&(o.width=C.width());
q=C.outerHeight(!0);
r=C.outerWidth(!0);
E();
z.contentContainer.css({height:"auto",width:"auto"});
o.left=N(!(!z.follow[0]&&g||J));
o.top=k(!(!z.follow[1]&&n||J));
C.animate(o,250,function(){i.show();
B=G()
})
}function I(){M.data("bPopup",s);
C.delegate(".bClose, ."+z.closeClass,"click."+l,p);
z.modalClose&&b(".b-modal."+l).css("cursor","pointer").bind("click",p);
m||!z.follow[0]&&!z.follow[1]||M.bind("scroll."+l,function(){B&&C.dequeue().animate({left:z.follow[0]?N(!J):"auto",top:z.follow[1]?k(!J):"auto"},z.followSpeed,z.followEasing)
}).bind("resize."+l,function(){O()
});
z.escClose&&L.bind("keydown."+l,function(d){27==d.which&&p()
})
}function f(i){function d(j){C.css({display:"block",opacity:1}).animate(j,z.speed,z.easing,function(){h(i)
})
}switch(i?z.transition:z.transitionClose||z.transition){case"slideIn":d({left:i?N(!(!z.follow[0]&&g||J)):L.scrollLeft()-(r||C.outerWidth(!0))-D});
break;
case"slideBack":d({left:i?N(!(!z.follow[0]&&g||J)):L.scrollLeft()+t+D});
break;
case"slideDown":d({top:i?k(!(!z.follow[1]&&n||J)):L.scrollTop()-(q||C.outerHeight(!0))-D});
break;
case"slideUp":d({top:i?k(!(!z.follow[1]&&n||J)):L.scrollTop()+v+D});
break;
default:C.stop().fadeTo(z.speed,i?1:0,function(){h(i)
})
}}function h(d){d?(I(),a(e),z.autoClose&&(F=setTimeout(p,z.autoClose))):(C.hide(),a(z.onClose),z.loadUrl&&(z.contentContainer.empty(),C.css({height:"auto",width:"auto"})))
}function N(d){return d?u+L.scrollLeft():u
}function k(d){return d?w+L.scrollTop():w
}function a(d,i){b.isFunction(d)&&d.call(C,i)
}function E(){w=n?z.position[1]:Math.max(0,(v-C.outerHeight(!0))/2-z.amsl);
u=g?z.position[0]:(t-C.outerWidth(!0))/2;
B=G()
}function G(){return v>C.outerHeight(!0)&&t>C.outerWidth(!0)
}b.isFunction(y)&&(e=y,y=null);
var z=b.extend({},b.fn.bPopup.defaults,y);
z.scrollBar||b("html").css("overflow","hidden");
var C=this,L=b(document),x=window,M=b(x),v=x.innerHeight||M.height(),t=x.innerWidth||M.width(),m=/OS 6(_\d)+/i.test(navigator.userAgent),D=200,s=0,l,B,n,g,J,w,u,q,r,c,F;
C.close=function(){p()
};
C.reposition=function(d){O(d)
};
return C.each(function(){b(this).data("bPopup")||(a(z.onOpen),s=(M.data("bPopup")||0)+1,l="__b-popup"+s+"__",n="auto"!==z.position[1],g="auto"!==z.position[0],J="fixed"===z.positionStyle,q=C.outerHeight(!0),r=C.outerWidth(!0),z.loadUrl?H():A())
})
};
b.fn.bPopup.defaults={amsl:50,appending:!0,appendTo:"body",autoClose:!1,closeClass:"b-close",content:"ajax",contentContainer:!1,easing:"swing",escClose:!0,follow:[!0,!0],followEasing:"swing",followSpeed:500,iframeAttr:'scrolling="no" frameborder="0"',loadCallback:!1,loadData:!1,loadUrl:!1,modal:!0,modalClose:!0,modalColor:"#000",onClose:!1,onOpen:!1,opacity:0.7,position:["auto","auto"],positionStyle:"absolute",scrollBar:!0,speed:250,transition:"fadeIn",transitionClose:!1,zIndex:9997}
})(jQuery);